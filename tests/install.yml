---

- name: Install - Nodejs 0.10
  hosts: all
  pre_tasks:
    - include: pre_tasks/nodesource_0_10.yml
  roles:
    - manala.nodejs
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            nodejs:
              installed: true
        - command:
            node --version:
              exit-status: 0
              stdout:
                - "v0.10."
            npm --version:
              exit-status: 0
              stdout:
                - "2."

- name: Install - Nodejs 0.12
  hosts: all
  pre_tasks:
    - include: pre_tasks/nodesource_0_12.yml
  roles:
    - manala.nodejs
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            nodejs:
              installed: true
        - command:
            node --version:
              exit-status: 0
              stdout:
                - "v0.12."
            npm --version:
              exit-status: 0
              stdout:
                - "2."

- name: Install - Nodejs 4
  hosts: all
  pre_tasks:
    - include: pre_tasks/nodesource_4.yml
  roles:
    - manala.nodejs
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            nodejs:
              installed: true
        - command:
            node --version:
              exit-status: 0
              stdout:
                - "v4."
            npm --version:
              exit-status: 0
              stdout:
                - "2."

- name: Install - Nodejs 5
  hosts: all
  pre_tasks:
    - include: pre_tasks/nodesource_5.yml
  roles:
    - manala.nodejs
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            nodejs:
              installed: true
        - command:
            node --version:
              exit-status: 0
              stdout:
                - "v5."
            npm --version:
              exit-status: 0
              stdout:
                - "3."

- name: Install - Nodejs 6
  hosts: all
  pre_tasks:
    - include: pre_tasks/nodesource_6.yml
  roles:
    - manala.nodejs
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            nodejs:
              installed: true
        - command:
            node --version:
              exit-status: 0
              stdout:
                - "v6."
            npm --version:
              exit-status: 0
              stdout:
                - "3."

- name: Install - Nodejs 7
  hosts: jessie
  pre_tasks:
    - include: pre_tasks/nodesource_7.yml
  roles:
    - manala.nodejs
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            nodejs:
              installed: true
        - command:
            node --version:
              exit-status: 0
              stdout:
                - "v7."
            npm --version:
              exit-status: 0
              stdout:
                - "4."
